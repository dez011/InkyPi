{% extends "plugin.html" %}

{% block content %}

{% set _font = (font_scale | default(1.0)) %}
{% set ps = plugin_settings | default({}) %}
{% set _tf12 = (time_format | default('24h')) == '12h' %}

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.17/index.global.min.js"></script>

<div id="calendar" class="calendar" style="
--fc-page-bg-color: {{ ps.backgroundColor | default('white') }};
--fc-border-color: {{ ps.textColor | default('black') }};
--fc-today-bg-color: '';
--fc-now-indicator-color: {{ ps.nowIndicatorColor | default('red') }};
--fc-event-border-color: {{ ps.textColor | default('black') }};

--fc-small-font-size: {{ 0.85 * _font }}em;
--fc-title-font-size: {{ 1.75 * _font }}em;
--fc-table-font-size: {{ 1 * _font }}em;
">

</div>

<script>
    const events = {{ (events | default([])) | tojson }};

    document.addEventListener('DOMContentLoaded', function () {
        const calendarEl = document.getElementById('calendar');
        const timeFormat = {
            hour: "numeric",
            minute: "2-digit",
            omitZeroMinute: {{ _tf12 | tojson }},
            hour12: {{ _tf12 | tojson }},
            meridiem: 'short'
        };

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: '{{ view | default("dayGridMonth") }}',
            events: events,
            now: '{{ current_dt | default("") }}',
            timeZone: '{{ timezone | default("local") }}',
            contentHeight: '100%',
            slotDuration: '01:00:00',
            expandRows: true,
            locale: "{{ ps.language | default('en') }}",
            firstDay: {{ ps.weekStartDay | default(0) | int }},
            slotLabelFormat: timeFormat,
            slotMinTime: "{{ (ps.startTimeInterval | default(0) | int) }}:00:00",
            slotMaxTime: "{{ (ps.endTimeInterval | default(24) | int) }}:00:00",
            eventTimeFormat: timeFormat,
            displayEventTime: {{ (ps.displayEventTime == "true") | tojson }},
            weekends:  {{ (ps.displayWeekends == "true") | tojson }},
            nowIndicator: {{ (ps.displayNowIndicator == "true") | tojson }},
            fixedWeekCount: false,
            {% if view == 'timeGrid' %}duration: {days : 7 },{% endif %}
            headerToolbar: {
                left: '',
                center: "{{ 'title' if plugin_settings.displayTitle == 'true' else '' }}",
                right: ''
            },
            slotDuration: "01:00:00"
        });
        calendar.render();
    });
</script>

{% endblock %}
